
<html>
  <body>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
    <link rel="stylesheet" href="styles.css"/>
    <style>#map { height: 500px; }</style>
    <script src="sfx.bundle.js"></script>
    <script>
      var app = angular.module('dte-example', ['eim-map']);
      
      app.controller("dte-mapper", ['$rootScope', '$scope', '$http', 'eim.mapper', function($rootScope, $scope, $http, mapper){
      $rootScope.$on("eim:onMapReady", function(e, m){
        
        $http.get('mapdata.json').then(
          
          function addTheMarkers(x){
            console.log(x);
            var d = x.data.slice(-5);
            d.forEach(function(data) {
              if(data.fields.latitude && data.fields.longitude)
                mapper.map.addMarker({
                  latlng: {
                    lat: data.fields.latitude,
                    lng: data.fields.longitude
                  },
                  fields: data.fields
                }); 
            });
          });
        });
      }]);  
    </script>
    <div id="map"></div>
    <div ng-app="dte-example" ng-controller="dte-mapper as ctrl">
      <eim-map markers="ctrl.markers">
        <eim-state key="green" val="green" icon-url="https://maps.google.com/mapfiles/ms/icons/green-dot.png"><img src="https://maps.google.com/mapfiles/ms/icons/green-dot.png"/></eim-state>
        <eim-popup>Hello World! {{marker.latlng.lat}}</eim-popup>
        
      </eim-map>
    </div>
  </body>
</html>